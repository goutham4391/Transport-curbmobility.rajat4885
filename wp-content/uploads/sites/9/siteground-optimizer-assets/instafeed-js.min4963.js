(function(){var a,b;a=function(){function a(a,c){var b,d;if(this.options={target:'instafeed',get:'popular',resolution:'thumbnail',sortBy:'none',links:!0,mock:!1,useHttp:!1},moment.locale('en'),console.log(svc_ajax_url.laungage),moment.locale(svc_ajax_url.laungage),typeof a=='object')for(b in a)d=a[b],this.options[b]=d;this.context=c!=null?c:this,this.unique=this._genKey()}return a.prototype.request=function(a,b){jQuery.ajax({url:a,dataType:'jsonp',success:b})},a.prototype.request_user=function(c,a,b){jQuery.ajax({url:svc_ajax_url.url,data:a,dataType:"jsonp",type:'GET',success:b})},a.prototype.get_user_id_data=function(a){if(typeof a.data=='undefined');else return a.data[0].id},a.prototype.hasNext=function(){return typeof this.context.nextUrl=='string'&&this.context.nextUrl.length>0},a.prototype.next=function(){return!!this.hasNext()&&this.run(this.context.nextUrl)},a.prototype.run=function(e){var d,c,b;if(typeof this.options.clientId!='string')if(typeof this.options.accessToken!='string')throw new Error("Missing clientId or accessToken.");if(typeof this.options.accessToken!='string')if(typeof this.options.clientId!='string')throw new Error("Missing clientId or accessToken.");return this.options.before!=null&&typeof this.options.before=='function'&&this.options.before.call(this),typeof document!="undefined"&&document!==null&&(b=document.createElement('script'),b.id='instafeed-fetcher',b.src=e||this._buildUrl(),d=document.getElementsByTagName('head'),d[0].appendChild(b),c="instafeedCache"+this.unique,window[c]=new a(this.options,this),window[c].unique=this.unique),!0},a.prototype.parse=function(b){var l,e,r,n,a,m,d,c,j,w,p,v,h,f,o,g,k,i,s,t,u,q;if(typeof b!='object'){if(this.options.error!=null&&typeof this.options.error=='function')return this.options.error.call(this,'Invalid JSON data'),!1;throw new Error('Invalid JSON response')}if(b.meta.code!==200)if(this.options.error!=null&&typeof this.options.error=='function')return this.options.error.call(this,b.meta.error_message),!1;if(b.data.length===0){if(this.options.error!=null&&typeof this.options.error=='function')return this.options.error.call(this,'No images were returned from Instagram'),!1;throw new Error('No images were returned from Instagram')}if(this.options.success!=null&&typeof this.options.success=='function'&&this.options.success.call(this,b),this.context.nextUrl='',b.pagination!=null&&(this.context.nextUrl=b.pagination.next_url),this.options.sortBy!=='none')switch(this.options.sortBy==='random'?f=['','random']:f=this.options.sortBy.split('-'),h=f[0]==='least',f[1]){case'random':b.data.sort(function(){return.5-Math.random()});break;case'recent':b.data=this._sortBy(b.data,'created_time',h);break;case'liked':b.data=this._sortBy(b.data,'likes.count',h);break;case'commented':b.data=this._sortBy(b.data,'comments.count',h);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}if(typeof document!="undefined"&&document!==null&&this.options.mock===!1){if(c=b.data,this.options.limit!=null&&c.length>this.options.limit&&(c=c.slice(0,this.options.limit+1||9e9)),e=document.createDocumentFragment(),this.options.filter!=null&&typeof this.options.filter=='function'&&(c=this._filter(c,this.options.filter)),this.options.template!=null&&typeof this.options.template=='string'){n='',m='',w='',insta_img='',o=document.createElement('div');for(g=0,s=c.length;g<s;g++)a=c[g],d=a.images[this.options.resolution].url,bigimageUrl=a.images.standard_resolution.url,username=a.user.full_name,(typeof username=='undefined'||username=='')&&(username=a.user.username),this.options.useHttp||(d=d.replace('http://','//')),m=this._makeTemplate(this.options.template,{model:a,username,time:moment(this._getObjectProperty(a,'created_time')*1e3).fromNow(),bigimage:bigimageUrl,id:a.id,link:a.link,image:d,caption:this._getObjectProperty(a,'caption.text'),likes:a.likes.count,comments:a.comments.count,location:this._getObjectProperty(a,'location.name')}),n+=m;o.innerHTML=n,q=[].slice.call(o.childNodes);for(k=0,t=q.length;k<t;k++)v=q[k],e.appendChild(v)}else for(i=0,u=c.length;i<u;i++)a=c[i],j=document.createElement('img'),d=a.images[this.options.resolution].url.replace("s150x150/",""),this.options.useHttp||(d=d.replace('http://','//')),j.src=d,this.options.links===!0?(l=document.createElement('a'),l.href=a.link,l.appendChild(j),e.appendChild(l)):e.appendChild(j);document.getElementById(this.options.target).appendChild(e),r=document.getElementsByTagName('head')[0],r.removeChild(document.getElementById('instafeed-fetcher')),p="instafeedCache"+this.unique,window[p]=void 0;try{delete window[p]}catch(a){}}return this.options.after!=null&&typeof this.options.after=='function'&&this.options.after.call(this),!0},a.prototype._buildUrl=function(){var c,b,a,d,e;switch(c="https://api.instagram.com/v1",d="https://api.instagram.com/v1/users/search/?q=shabbyapple&client_id="+this.options.clientId+"&count=1",this.options.get){case"popular":b="media/popular";break;case"tagged":if(typeof this.options.tagName!='string')throw new Error("No tag name specified. Use the 'tagName' option.");b="tags/"+this.options.tagName+"/media/recent";break;case"location":if(typeof this.options.locationId!='number')throw new Error("No location specified. Use the 'locationId' option.");b="locations/"+this.options.locationId+"/media/recent";break;case"user":typeof this.options.userId!='number',typeof this.options.accessToken!='string',b="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}if(a=""+c+"/"+b,this.options.accessToken!=null?a+="?access_token="+this.options.instagram_access_token:a+="?access_token="+this.options.instagram_access_token,this.options.limit!=null&&(a+="&count="+this.options.limit),a+="&callback=instafeedCache"+this.unique+".parse",this.options.get=='user')console.log('h'),this.request_user(a,'action=svc_get_insta_feed_post&access_token='+this.options.instagram_access_token+'&userid='+this.options.userId+'&count='+this.options.limit+'&cache_time='+this.options.cache_time+'&unique='+this.unique);else if(this.options.get=='tagged')this.request_user(a,'action=svc_get_insta_tag_post&access_token='+this.options.instagram_access_token+'&tag_name='+this.options.tagName+'&count='+this.options.limit+'&cache_time='+this.options.cache_time+'&unique='+this.unique+'&cache_id='+this.options.cache_id);else return a},a.prototype._genKey=function(){var a;return a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},""+a()+a()+a()+a()},a.prototype._makeTemplate=function(g,f){var a,b,d,e,c;for(b=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,a=g;b.test(a);)d=a.match(b)[1],e=(c=this._getObjectProperty(f,d))!=null?c:'',a=a.replace(b,""+e);return a},a.prototype._getObjectProperty=function(a,b){var c,d;for(b=b.replace(/\[(\w+)\]/g,'.$1'),d=b.split('.');d.length;)if(c=d.shift(),a!=null&&c in a)a=a[c];else return null;return a},a.prototype._sortBy=function(a,b,d){var c;return c=function(e,f){var a,c;return a=this._getObjectProperty(e,b),c=this._getObjectProperty(f,b),d?a>c?1:-1:a<c?1:-1},a.sort(c.bind(this)),a},a.prototype._filter=function(c,g){var b,d,e,a,f;b=[],e=function(a){if(g(a))return b.push(a)};for(a=0,f=c.length;a<f;a++)d=c[a],e(d);return b},a}(),b=typeof exports!="undefined"&&exports!==null?exports:window,b.Instafeed=a}).call(this)